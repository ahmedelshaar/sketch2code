<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{  url_for('static', filename='css/editor.css') }}">
</head>
<body>
    <div id="app">
        <div class="elements" :class="{ active: editor }">
            {% for element in elements %}
                <div @click="element({{ element['id'] }}, $event)" data-type="{{ element['type'] }}" style="top:{{ element['y1'] }}px;left:{{ element['x1'] }}px;height:{{ element['height'] }}px;width:{{ element['width'] }}px;"></div>
            {% endfor %}
        </div>
        <div class="bg-dark text-white bg-gradient editor p-3" v-if="id != null">
            <select class="form-select" v-model="type">
                <option v-for="element in elements">[[ element ]]</option>
            </select>
            <div v-if="type === 'Horizontal Navbar'">

            </div>
            <div v-if="type === 'Youtube'">
                <div class="my-3">
                    <label for="youtubeurl" class="form-label">Youtube Url</label>
                    <input type="email" id="youtubeurl" class="form-control" v-model="youtube" placeholder="https://youtu.be/">
                </div>
            </div>
            <button class="btn btn-success mt-3 w-100" @click="save">Save</button>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/vue@2"></script>
    <script>
        new Vue({
            el: '#app',
            delimiters : ['[[', ']]'],
            data: {
                elements: ['Chart Line', 'Check Box', 'Horizontal Navbar', 'Image Circle', 'Image Rectangular', 'Input text.html',
                'Map', 'Paragraph', 'Pie charts', 'Radio Button', 'Search', 'Stack bar', 'Textarea',
                'Vertical Navbar', 'Youtube', 'Text', 'Link', 'Button'],
                target: null,
                editor: false,
                json: null,
                id: null,
                type: null,
                youtube: null,
                path: '{{ pathname }}',
            },
            methods: {
                element: function(id, e){
                    this.target = e.target
                    this.editor = true
                    this.id = id
                    this.type = this.json[id]['type']
                },
                save: function(e){
                    axios.post("{{ url_for('save2', name=name) }}", this.json)
                        .then(response => this.articleId = response.data.id);
                },
            },
            watch: {
                id: function(value){

                    // assign value
                    if (this.json[value]['type'] == "Youtube"){
                        this.youtube = this.json[value]['url'];
                    }

                },
                type: function(value){
                    this.target.setAttribute('data-type', value);
                    this.json[this.id]['type'] = value

                    // Rest Value
                    if (this.json[this.id]['type'] == "Youtube"){
                        this.youtube = "";
                    }

                },
                youtube: function(value){
                    this.json[this.id]["url"] = value
                }
            },
            created: function () {
                fetch(this.path)
                  .then(r => r.json())
                  .then(json => {
                    this.json = json;
                  });
              }
        })
    </script>
</body>
</html>